@using BCKFreightTMS.Data.Models
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> userManager
@{ 
    var user = await this.userManager.GetUserAsync(this.User);
    string picSrc;
    if (user.ProfilePicture is null)
    {
        picSrc = "/img/default-user-icon-4.jpg";
    }
    else
    {
        picSrc = $"data:image/*;base64,{(Convert.ToBase64String(user.ProfilePicture))}";
    }
}

<aside class="main-sidebar position-fixed sidebar-dark-primary elevation-4">
    <a class="brand-link d-flex justify-content-center" asp-area="" asp-controller="Dashboard" asp-action="Index">
        <img src="~/img/logo_full2.svg" class="img-fluid"
        style="max-width: 75%">
        @*<span class="brand-text font-weight-light">BCK Freight</span>*@
    </a>

    <div class="sidebar">
        <div class="user-panel mb-3 d-flex align-items-center">
            @if (User.Identity.IsAuthenticated)
            {
                <div class="image pl-2">
                    <img src="@picSrc" class="img-circle elevation-2 align-middle" alt="User Image">
                </div>
                <div class="info mr-2 pr-2 text-white align-middle">
                    @this.User.Identity.Name
                    <p class="text-bold m-0">@user.Company.Name</p>
                </div>
                <div class="info pl-4 ml-auto align-middle">
                        <a class="d-block" asp-area="Identity" asp-page="/Account/Manage/Index"><i class="fas fa-user-cog"></i></a>
                </div>
            }
            else
            {
                <div class="info mr-2">
                    <a class="d-block">Guest</a>
                </div>
            }
        </div>
        <nav class="mt-2">
            <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                @if (this.User.Identity.IsAuthenticated && this.User.IsInRole("User"))
                {
                    <li class="nav-item">
                        <a asp-area="" asp-controller="Dashboard" asp-action="Index" class="nav-link @Url.MakeActiveClass("dashboard", null, "active")">
                            <i class="nav-icon fas fa-tachometer-alt"></i>
                            <p>Dashboard</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-area="" asp-controller="Contacts" asp-action="Index" class="nav-link @Url.MakeActiveClass("contacts", null, "active")">
                            <i class="nav-icon fas fa-address-book"></i>
                            <p>Contacts</p>
                        </a>
                    </li>
                    <li class="nav-item has-treeview @Url.MakeActiveClass(new[] { "orders" }, "menu-open")">
                        <a href="#" class="nav-link @Url.MakeActiveClass(new[] { "orders" }, "active")">
                            <i class="nav-icon fab fa-buffer"></i>
                            <p>
                            Orders
                            <i class="fas fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item pl-3">
                                <a asp-area="" asp-controller="Orders" asp-action="Accepted" class="nav-link">
                                    <i class="nav-icon fas fa-check-circle"></i>
                                    <p>Accepted</p>
                                </a>
                                <a asp-area="" asp-controller="Orders" asp-action="Index" class="nav-link">
                                    <i class="nav-icon fas fa-flag-checkered"></i>
                                    <p>Active</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a asp-area="" asp-controller="Cargos" asp-action="Index" class="nav-link @Url.MakeActiveClass("cargos", null, "active")">
                            <i class="nav-icon fas fa-truck-loading"></i>
                            <p>Cargos</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a asp-area="" asp-controller="Vehicles" asp-action="Index" class="nav-link @Url.MakeActiveClass("vehicles", null, "active")">
                            <i class="nav-icon fas fa-truck"></i>
                            <p>Vehicles</p>
                        </a>
                    </li>
                    @if (this.User.IsInRole("SuperUser"))
                    {
                        <li class="nav-item has-treeview @Url.MakeActiveClass(new[] { "users", "settings" }, "menu-open")">
                            <a href="#" class="nav-link @Url.MakeActiveClass(new[] { "users", "settings" }, "active")">
                                <i class="nav-icon fas fa-cog"></i>
                                <p>
                                Setings
                                <i class="fas fa-angle-left right"></i>
                                </p>
                            </a>
                            <ul class="nav nav-treeview">
                                <li class="nav-item pl-3">
                                    <a asp-area="" asp-controller="Users" asp-action="Index" class="nav-link @Url.MakeActiveClass("users", null, "active")">
                                        <i class="nav-icon fas fa-users"></i>
                                        <p>Users</p>
                                    </a>
                                    <a asp-area="" asp-controller="Settings" asp-action="Index" class="nav-link @Url.MakeActiveClass("settings", null, "active")">
                                        <i class="nav-icon fas fa-clipboard-check"></i>
                                        <p>Configuration</p>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    }
                }
            </ul>
        </nav>
    </div>
</aside>
